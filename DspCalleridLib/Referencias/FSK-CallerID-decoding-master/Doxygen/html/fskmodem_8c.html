<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CallerID FSK Decoding: fskmodem.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CallerID FSK Decoding
   </div>
   <div id="projectbrief">Decode CallerID message from an audio file</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fskmodem_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fskmodem.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>FSK Demodulation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="filter__coefficients_8h_source.html">filter_coefficients.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fskmodem_8h_source.html">fskmodem.h</a>&quot;</code><br />
<code>#include &quot;gnuplot_i.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad72dbcf6d0153db1b8d8a58001feed83"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ad72dbcf6d0153db1b8d8a58001feed83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42f8c497a1968074f38bf5055c650dca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a42f8c497a1968074f38bf5055c650dca">VERBOSE</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a42f8c497a1968074f38bf5055c650dca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cbea62f1ce2043dd08108e65ed8de1d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a0cbea62f1ce2043dd08108e65ed8de1d">SCALE</a>&#160;&#160;&#160;30000000</td></tr>
<tr class="separator:a0cbea62f1ce2043dd08108e65ed8de1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ea6438b983b0c97d1e3316b97399f2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a7ea6438b983b0c97d1e3316b97399f2c">STATE_SEARCH_STARTBIT</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a7ea6438b983b0c97d1e3316b97399f2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73b827225345cd87e7753e4ae25a9f72"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a73b827225345cd87e7753e4ae25a9f72">STATE_SEARCH_STARTBIT2</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a73b827225345cd87e7753e4ae25a9f72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a638f6da6711c934bdbd08bffa1b2822e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a638f6da6711c934bdbd08bffa1b2822e">STATE_CHANNEL_SEIZURE</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a638f6da6711c934bdbd08bffa1b2822e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af915cce8ac646fd21d7a7acd1345c7ed"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#af915cce8ac646fd21d7a7acd1345c7ed">STATE_MARK_SIGNAL</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:af915cce8ac646fd21d7a7acd1345c7ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa986dbb00367acd1b750603bd888b3ff"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#aa986dbb00367acd1b750603bd888b3ff">STATE_GET_DATA_FRAME</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:aa986dbb00367acd1b750603bd888b3ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a326f107539430dc475144721e8a3d688"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a326f107539430dc475144721e8a3d688">iget_sample</a> (short **buffer, int *len)</td></tr>
<tr class="memdesc:a326f107539430dc475144721e8a3d688"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current sample.  <a href="#a326f107539430dc475144721e8a3d688">More...</a><br /></td></tr>
<tr class="separator:a326f107539430dc475144721e8a3d688"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cd322aafcc68375d9ee1f5ac4d60b46"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a0cd322aafcc68375d9ee1f5ac4d60b46">filter</a> (struct <a class="el" href="structfilter__struct.html">filter_struct</a> *fs, int in)</td></tr>
<tr class="memdesc:a0cd322aafcc68375d9ee1f5ac4d60b46"><td class="mdescLeft">&#160;</td><td class="mdescRight">General function for filtering any frequency.  <a href="#a0cd322aafcc68375d9ee1f5ac4d60b46">More...</a><br /></td></tr>
<tr class="separator:a0cd322aafcc68375d9ee1f5ac4d60b46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e056276c5df3a6f1803aed2313871cf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a1e056276c5df3a6f1803aed2313871cf">idemodulator</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd, int *retval, int x)</td></tr>
<tr class="memdesc:a1e056276c5df3a6f1803aed2313871cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">FSK demodulation.  <a href="#a1e056276c5df3a6f1803aed2313871cf">More...</a><br /></td></tr>
<tr class="separator:a1e056276c5df3a6f1803aed2313871cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183afaf79ee92e26e8aacd129d9be3cb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a183afaf79ee92e26e8aacd129d9be3cb">fskmodem_init</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd)</td></tr>
<tr class="memdesc:a183afaf79ee92e26e8aacd129d9be3cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the FSK data.  <a href="#a183afaf79ee92e26e8aacd129d9be3cb">More...</a><br /></td></tr>
<tr class="separator:a183afaf79ee92e26e8aacd129d9be3cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a352dc6016a3e45d7f3573d4cb08c1927"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a352dc6016a3e45d7f3573d4cb08c1927">get_bit_raw</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd, short *buffer, int *len)</td></tr>
<tr class="memdesc:a352dc6016a3e45d7f3573d4cb08c1927"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a single bit of FSK signal.  <a href="#a352dc6016a3e45d7f3573d4cb08c1927">More...</a><br /></td></tr>
<tr class="separator:a352dc6016a3e45d7f3573d4cb08c1927"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ed86518cd99a7ea692c11a396ef2722"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a6ed86518cd99a7ea692c11a396ef2722">get_channel_seizure</a> (<a class="el" href="structfsk__data.html">fsk_data</a> **fskd, short **buffer, int **len)</td></tr>
<tr class="memdesc:a6ed86518cd99a7ea692c11a396ef2722"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detecting channel seizure signal.  <a href="#a6ed86518cd99a7ea692c11a396ef2722">More...</a><br /></td></tr>
<tr class="separator:a6ed86518cd99a7ea692c11a396ef2722"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a355770a7620fc3d37477ba433579504c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a355770a7620fc3d37477ba433579504c">get_mark_signal</a> (<a class="el" href="structfsk__data.html">fsk_data</a> **fskd, short **buffer, int **len)</td></tr>
<tr class="memdesc:a355770a7620fc3d37477ba433579504c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detecting Mark signal.  <a href="#a355770a7620fc3d37477ba433579504c">More...</a><br /></td></tr>
<tr class="separator:a355770a7620fc3d37477ba433579504c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3589b6f2cd9585fe74361841da0de198"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a3589b6f2cd9585fe74361841da0de198">get_data_frame</a> (<a class="el" href="structfsk__data.html">fsk_data</a> **fskd, short **buffer, int **len)</td></tr>
<tr class="memdesc:a3589b6f2cd9585fe74361841da0de198"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the data frame.  <a href="#a3589b6f2cd9585fe74361841da0de198">More...</a><br /></td></tr>
<tr class="separator:a3589b6f2cd9585fe74361841da0de198"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6315165519388f15eccffd8103769ee3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#a6315165519388f15eccffd8103769ee3">fsk_serial</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd, short *buffer, int *len, int *outbyte)</td></tr>
<tr class="memdesc:a6315165519388f15eccffd8103769ee3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve a serial byte into outbyte.  <a href="#a6315165519388f15eccffd8103769ee3">More...</a><br /></td></tr>
<tr class="separator:a6315165519388f15eccffd8103769ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad43c3812e6d13e0518d9f8b8f463ffcf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0</td></tr>
<tr class="separator:ad43c3812e6d13e0518d9f8b8f463ffcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>FSK Demodulation. </p>
<dl class="section author"><dt>Author</dt><dd>Jenil Jain </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2015 Insensi Inc. All rights reserved. This project is released under the GNU Public License.</dd></dl>
<p>Demodulate the CallerID FSK data by using various filter based on the FSK frequencies.</p>
<dl class="section note"><dt>Note</dt><dd>Includes code and algorithms from the Zapata library and Aesterisk. </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ad72dbcf6d0153db1b8d8a58001feed83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0cbea62f1ce2043dd08108e65ed8de1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCALE&#160;&#160;&#160;30000000</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a638f6da6711c934bdbd08bffa1b2822e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_CHANNEL_SEIZURE&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa986dbb00367acd1b750603bd888b3ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_GET_DATA_FRAME&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="af915cce8ac646fd21d7a7acd1345c7ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_MARK_SIGNAL&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7ea6438b983b0c97d1e3316b97399f2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_SEARCH_STARTBIT&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a73b827225345cd87e7753e4ae25a9f72"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATE_SEARCH_STARTBIT2&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a42f8c497a1968074f38bf5055c650dca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERBOSE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0cd322aafcc68375d9ee1f5ac4d60b46"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfilter__struct.html">filter_struct</a> *&#160;</td>
          <td class="paramname"><em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>in</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>General function for filtering any frequency. </p>
<p>All the filters used are IIR Butterworth filter and the general equation for it, is</p>
<p>y[n] = c0*x[n] + c1*x[n-1] + ... + cM*x[n-M] - ( d1*y[n-1] + d2*y[n-2] + ... + dN*y[n-N]) <br />
 where N = no. of previous outputs &amp; <br />
 M = no. of previous inputs <br />
 c1,c2,...,cM = input coefficients <br />
 d1,d2,...,dN = output coefficients <br />
 x[n] = input values <br />
 y[n] = output values <br />
</p>
<p>The c_coef, d_coef and the gain depends on the order and type of the filter</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>structer containing all the filter parameter for a particular frequency </td></tr>
    <tr><td class="paramname">in</td><td>current input value</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>current output value </dd></dl>

</div>
</div>
<a class="anchor" id="a6315165519388f15eccffd8103769ee3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fsk_serial </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>outbyte</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve a serial byte into outbyte. </p>
<p>Buffer is a pointer into a series of shorts and len records the number of bytes in the buffer. len will be overwritten with the number of bytes left that were not consumed.</p>
<dl class="section return"><dt>Returns</dt><dd>return value is as follows: <ul>
<li>0: Still looking for something... </li>
<li>1: An output byte was received and stored in outbyte </li>
<li>-1: An error occured in the transmission </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a183afaf79ee92e26e8aacd129d9be3cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fskmodem_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&#160;</td>
          <td class="paramname"><em>fskd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the FSK data. </p>
<p>Initialize all the parameters used by the filter and demodulator functions to decode the CID message. The parameters are already calculated in filter_coefficient.h file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>pointer to <a class="el" href="structfsk__data.html">fsk_data</a> struct </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a352dc6016a3e45d7f3573d4cb08c1927"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_bit_raw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a single bit of FSK signal. </p>
<p>This function implements a DPLL to synchronize with the bits and decode a single FSK bit data. It looks for the transition between 0s and 1s and adjust the PLL value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>pointer to data struct containing FSK parameters </td></tr>
    <tr><td class="paramname">buffer</td><td>pointer to buffer containing samples </td></tr>
    <tr><td class="paramname">len</td><td>pointer to current number of samples in the buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0x80</td><td>if the FSK bit is 1 </td></tr>
    <tr><td class="paramname">0x00</td><td>if the FSK bit is 0. </td></tr>
    <tr><td class="paramname">-1</td><td>if the number fo samples are not sufficient for a bit </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a6ed86518cd99a7ea692c11a396ef2722"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_channel_seizure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> **&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short **&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Detecting channel seizure signal. </p>
<p>The Caller ID message starts with a Channel seizure signal which consists 300 bits containing alternate 1s and 0s. Checking if we detected the channel seizure signal properly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>Address of pointer to FSK data structure </td></tr>
    <tr><td class="paramname">buffer</td><td>Address of pointer to current sample </td></tr>
    <tr><td class="paramname">len</td><td>Address of pointer containing pointer of length</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful else -1 if error </dd></dl>

</div>
</div>
<a class="anchor" id="a3589b6f2cd9585fe74361841da0de198"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_data_frame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> **&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short **&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the data frame. </p>
<p>Data bytes starts after the Mark signal. The message consists of a sequence of 10-bit frames. A start bit(0), 8 bits of information(LSB to MSB) and then a stop bit(1).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>Address of pointer to FSK data structure </td></tr>
    <tr><td class="paramname">buffer</td><td>Address of pointer to current sample </td></tr>
    <tr><td class="paramname">len</td><td>Address of pointer containing pointer of length</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful else -1 if error </dd></dl>

</div>
</div>
<a class="anchor" id="a355770a7620fc3d37477ba433579504c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_mark_signal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> **&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short **&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Detecting Mark signal. </p>
<p>After the channel seizure, there is a sequence of 180 Mark signals. The purpose of the Channel Seizure Signal and the Mark Signal is to prepare the data receiver in the Customer Premise Equipment (CPE) for the reception of the actual CID message</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>Address of pointer to FSK data structure </td></tr>
    <tr><td class="paramname">buffer</td><td>Address of pointer to current sample </td></tr>
    <tr><td class="paramname">len</td><td>Address of pointer containing pointer of length</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful else -1 if error </dd></dl>

</div>
</div>
<a class="anchor" id="a1e056276c5df3a6f1803aed2313871cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int idemodulator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&#160;</td>
          <td class="paramname"><em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>retval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>FSK demodulation. </p>
<p>For FSK demodulation using recursive filter, the waveform is passed through Mark and Space filter to create the respective envelope. Based on the filter values, decision is made whether it's Mark or it's Space. But the values generated by this filter can fade, so we use a low pass filter to differentiate between the two frequencies.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fskd</td><td>pointer to the data struct containing FSK parameters </td></tr>
    <tr><td class="paramname">retval</td><td>pointer to contain the demodulated value </td></tr>
    <tr><td class="paramname">x</td><td>Current value of the sample </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a326f107539430dc475144721e8a3d688"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int iget_sample </td>
          <td>(</td>
          <td class="paramtype">short **&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the current sample. </p>
<p>Get the value of the current sample and increment the pointer. Also decrement the length.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Address of pointer of current sample </td></tr>
    <tr><td class="paramname">len</td><td>Address of the length variable </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>current sample value </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ad43c3812e6d13e0518d9f8b8f463ffcf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int count = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="fskmodem_8c.html">fskmodem.c</a></li>
    <li class="footer">Generated on Fri Jul 17 2015 17:47:15 for CallerID FSK Decoding by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
